[supervisord]
nodaemon=true
user=root
logfile=/app/logs/supervisord.log
pidfile=/app/supervisord.pid

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# Backend service - Alice Python/FastAPI server
[program:backend]
command=python3 -m uvicorn app:app --host 0.0.0.0 --port 8000 --workers 2
directory=/app/server
user=alice
autostart=true
autorestart=true
stderr_logfile=/app/logs/backend_error.log
stdout_logfile=/app/logs/backend_out.log
environment=PYTHONPATH="/app/server",NODE_ENV="production"

# Frontend service - Next.js web server
[program:frontend]
command=node_modules/.bin/next start --port 3000
directory=/app/web
user=alice
autostart=true
autorestart=true
stderr_logfile=/app/logs/frontend_error.log
stdout_logfile=/app/logs/frontend_out.log
environment=NODE_ENV="production",PORT="3000"

# Nginx reverse proxy
[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
stderr_logfile=/app/logs/nginx_error.log
stdout_logfile=/app/logs/nginx_out.log

# Log monitoring (optional)
[program:log-monitor]
command=/bin/bash -c 'tail -f /app/logs/*.log'
autostart=false
autorestart=false
stderr_logfile=/dev/null
stdout_logfile=/dev/null