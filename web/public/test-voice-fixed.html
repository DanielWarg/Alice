<!doctype html>
<html lang="sv">
  <meta charset="utf-8" />
  <title>Voice WS Quick Test</title>
  <body style="font-family: ui-sans-serif, system-ui; padding:20px; background:#0b1220; color:#c8f6ff">
    <h1>Voice Gateway â€“ Quick WS Test</h1>
    <p id="status">Status: <strong>idle</strong></p>
    <button id="connect">Connect</button>
    <button id="disconnect">Disconnect</button>
    <div style="margin-top: 20px; font-size: 14px; opacity: 0.7;">
      <p>Environment: <span id="env"></span></p>
      <p>WebSocket URL: <span id="wsurl"></span></p>
    </div>
    <script>
      let ws;
      const status = document.getElementById("status");
      const envSpan = document.getElementById("env");
      const wsurlSpan = document.getElementById("wsurl");
      
      function wsUrl() {
        const proto = location.protocol === "https:" ? "wss:" : "ws:";
        const path = "/ws/voice-gateway"; // Default path
        const url = `${proto}//${location.host}${path}`;
        wsurlSpan.textContent = url;
        return url;
      }
      
      envSpan.textContent = `${location.protocol}//${location.host}`;
      wsUrl(); // Set initial URL display
      
      document.getElementById("connect").onclick = () => {
        const url = wsUrl();
        console.log('ğŸŒ Connecting to:', url);
        ws = new WebSocket(url);
        
        ws.onopen = () => {
          console.log('âœ… WebSocket connected');
          status.innerHTML = "Status: <strong>connected âœ…</strong>";
        };
        
        ws.onclose = (ev) => {
          console.log('ğŸ”Œ WebSocket closed:', ev.code, ev.reason);
          status.innerHTML = `Status: <strong>closed (${ev.code})</strong>`;
        };
        
        ws.onerror = (ev) => {
          console.error('âŒ WebSocket error:', ev);
          status.innerHTML = "Status: <strong>error âŒ</strong>";
        };
        
        ws.onmessage = (ev) => {
          console.log("ğŸ“¨ WS message:", ev.data);
          status.innerHTML = `Status: <strong>connected âœ… (got message)</strong>`;
        };
      };
      
      document.getElementById("disconnect").onclick = () => {
        if (ws) {
          console.log('ğŸ”Œ Disconnecting WebSocket');
          ws.close();
          ws = null;
        }
      };
    </script>
  </body>
</html>